<html>
    <head>
        <meta charset="utf-8">

        <title>
            Watching
        </title>

        <link rel="stylesheet" href="./css/style.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"></script>
        <script>
            var url = window.location.protocol + "//" + window.location.host + "/";
            var socket = io(url);

            var position_data = null;

            socket.on('display', function(data) {
                document.getElementById("board").innerHTML = data['svg'];

                var record = document.getElementById("record");
                record.innerHTML = "";

                var ply = 0;
                data['kif'].forEach(function(item, index) {
                    var option = document.createElement("option");
                    option.text = item;
                    record.add(option);
                    ply++;
                });

                record.scrollTop = record.scrollHeight * Math.max(ply - 1, 0) / ply;

                var timelimit = data['timelimit'];

                document.getElementById("btime").innerHTML = "先手残り " + timelimit['btime'] + " 秒 秒読み " + timelimit['bbyoyomi'] + " 秒";
                document.getElementById("wtime").innerHTML = "後手残り " + timelimit['wtime'] + " 秒 秒読み " + timelimit['wbyoyomi'] + " 秒";
            });

            var display = function() {
                socket.emit('view');
            };

            setInterval(display, 700);
        </script>
    </head>

    <body>
        <div>
            <div>
                <div id="board">
                </div>

                <select id="record" size="10">
                </select>
            </div>

            <div id="btime"></div>
            <div id="wtime"></div>
        </div>
    </body>
</html>
